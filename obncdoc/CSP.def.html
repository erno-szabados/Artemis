<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Strict//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd'>
<html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>
	<head>
		<meta name='viewport' content='width=device-width, initial-scale=1.0' />
		<meta http-equiv='Content-Type' content='text/html; charset=utf-8' />
		<title>DEFINITION CSP</title>
		<link rel='stylesheet' type='text/css' href='style.css' />
	</head>
	<body>
		<p><a href='index.html'>Index</a></p>

		<pre>
<span class='comment'>(*
    CSP.Mod - Communicating Sequential Processes implementation
    
    A minimal CSP implementation following Hoare's model with channels and processes.
    Built on Artemis Collections for portability.
    
    Copyright (C) 2025
    Released under The 3-Clause BSD License.
*)</span>
DEFINITION <em>CSP</em>;

IMPORT Collections;

CONST
    <span class='comment'>(* Channel states *)</span>
    OPEN = 0;
    CLOSED = 1;

    <span class='comment'>(* Process states *)</span>
    READY = 0;
    RUNNING = 1;
    BLOCKED = 2;
    FINISHED = 3;

TYPE
    <span class='comment'>(* Opaque channel type for message passing *)</span>
    Channel = POINTER TO ChannelDesc;

    <span class='comment'>(* Process procedure type *)</span>
    ProcessProc = PROCEDURE;

    <span class='comment'>(* Opaque process type *)</span>
    Process = POINTER TO ProcessDesc;

    <span class='comment'>(* Waiter for blocking operations *)</span>
    Waiter = POINTER TO WaiterDesc;

    <span class='comment'>(* Simple scheduler *)</span>
    Scheduler = POINTER TO SchedulerDesc;

<span class='comment'>(* Create a new channel with given capacity (0 = synchronous) *)</span>
PROCEDURE <em>NewChannel</em>(capacity: INTEGER): Channel;

<span class='comment'>(* Free a channel and its resources *)</span>
PROCEDURE <em>FreeChannel</em>(VAR ch: Channel);

<span class='comment'>(* Close a channel (no more sends allowed) *)</span>
PROCEDURE <em>CloseChannel</em>(ch: Channel);

<span class='comment'>(* Check if channel is closed *)</span>
PROCEDURE <em>IsClosed</em>(ch: Channel): BOOLEAN;

<span class='comment'>(* Non-blocking send - returns TRUE if sent, FALSE if would block *)</span>
PROCEDURE <em>TrySend</em>(ch: Channel; item: Collections.ItemPtr): BOOLEAN;

<span class='comment'>(* Non-blocking receive - returns TRUE if received, FALSE if would block *)</span>
PROCEDURE <em>TryReceive</em>(ch: Channel; VAR item: Collections.ItemPtr): BOOLEAN;

<span class='comment'>(* Blocking send (simplified - would need scheduler integration) *)</span>
PROCEDURE <em>Send</em>(ch: Channel; item: Collections.ItemPtr);

<span class='comment'>(* Blocking receive (simplified - would need scheduler integration) *)</span>
PROCEDURE <em>Receive</em>(ch: Channel; VAR item: Collections.ItemPtr);

<span class='comment'>(* Create a new process *)</span>
PROCEDURE <em>NewProcess</em>(proc: ProcessProc): Process;

<span class='comment'>(* Create a new scheduler *)</span>
PROCEDURE <em>NewScheduler</em>(): Scheduler;

<span class='comment'>(* Add a process to scheduler *)</span>
PROCEDURE <em>AddProcess</em>(sched: Scheduler; proc: Process);

<span class='comment'>(* Wait for a process to finish. Returns TRUE if successful, FALSE otherwise. *)</span>
PROCEDURE <em>JoinProcess</em>(proc: Process): BOOLEAN;

<span class='comment'>(* Simple cooperative yield *)</span>
PROCEDURE <em>Yield</em>();

<span class='comment'>(* Run the scheduler (simplified) *)</span>
PROCEDURE <em>Run</em>(sched: Scheduler);

<span class='comment'>(* Initialize default scheduler *)</span>
PROCEDURE <em>Init</em>();

<span class='comment'>(* Get default scheduler *)</span>
PROCEDURE <em>DefaultScheduler</em>(): Scheduler;

END CSP.
</pre>
	</body>
</html>
